﻿'use client';

import { Fragment, useState, useEffect, useMemo } from 'react';
import { Card, CardHeader, CardTitle, CardContent, Input } from '@/components/ui';
import type { Building, BuildingProcessPlan, ProcessCategory, ProcessType } from '@/lib/types';
import { getBuildings } from '@/lib/services/buildings';
import { toast } from 'sonner';
import { Calendar, ChevronDown, ChevronUp } from 'lucide-react';
import { getProcessModule } from '@/lib/data/process-modules';
import { getQuantityByReference, getQuantityFromFloor } from '@/lib/utils/quantity-reference';
import { 
  calculateTotalWorkers, 
  calculateDailyInputWorkers, 
  calculateTotalWorkDays,
  calculateWorkDaysWithRounding,
  calculateEquipmentCount,
  calculateDailyInputWorkersByEquipment,
  calculateDailyInputWorkersByWorkDays,
} from '@/lib/utils/process-calculation';

interface Props {
  projectId: string;
}

// 공정 구분 목록
const PROCESS_CATEGORIES: ProcessCategory[] = ['버림', '기초', '지?�골�?, '?�팅�?, '기�?�?, 'PH�?];

// 공정 ?�???�션 (구분별로 ?�름)
const PROCESS_TYPE_OPTIONS: Record<ProcessCategory, ProcessType[]> = {
  '버림': ['?��?공정'],
  '기초': ['?��?공정'],
  '지?�골�?: ['?��?공정', '지?�외�??�벽 ?�용', '?�체?�???�용'],
  '?�팅�?: ['?��?공정'],
  '기�?�?: ['5???�이??, '6???�이??, '7???�이??, '8???�이??],
  'PH�?: ['?��?공정'],
};

// 기본 공정 ?�??const DEFAULT_PROCESS_TYPES: Record<ProcessCategory, ProcessType> = {
  '버림': '?��?공정',
  '기초': '?��?공정',
  '지?�골�?: '?��?공정',
  '?�팅�?: '?��?공정',
  '기�?�?: '6???�이??,
  'PH�?: '?��?공정',
};

export function BuildingProcessPlanPage({ projectId }: Props) {
  const [buildings, setBuildings] = useState<Building[]>([]);
  const [processPlans, setProcessPlans] = useState<Map<string, BuildingProcessPlan>>(new Map());
  const [isLoading, setIsLoading] = useState(false);
  const [expandedModules, setExpandedModules] = useState<Map<string, Set<string>>>(new Map()); // buildingId-category 조합

  // 기�?층에 ?�당?�는 �?목록 추출 (�??�별�? - ?�기본정�??�이지??층설???�이?
